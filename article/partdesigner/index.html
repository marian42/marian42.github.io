
<!doctype html>
<html class="no-js" lang="en">
    <head>
        <title>
            Lego Part Designer | Marian's Blog
		</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Marian Kleineberg">
        <meta name="description" content="Lego Part Designer - Personal blog about game development, programming and making">
        <meta itemprop="name" content="Lego Part Designer">
        <meta itemprop="description" content="Lego Part Designer - Personal blog about game development, programming and making">
        <meta property="og:title" content="Lego Part Designer">
        <meta property="og:description" content="Lego Part Designer - Personal blog about game development, programming and making">
        <meta property="og:image" content="https://marian42.de/article/partdesigner/partdesigner.png">
        <meta property="og:url" content="https://marian42.de/article/partdesigner/">
        <meta property="og:site_name" content="Marian's Blog"><meta property="og:type" content="website">

        <link rel="icon" type="image/png" href="https://marian42.de/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://marian42.de/favicon-16x16.png" sizes="16x16">

        <link href="https://marian42.de/index.xml" rel="feed" type="application/rss+xml" title="Marian's Blog" />
                
        <link rel="stylesheet" href="/style.css">        
    </head>
    <body>
        <header class="triangle-pattern">
            <div class="container">
                <a href="/" class="logo" alt="Marian's Blog">
                </a>
            </div>
        </header>
        
        <article class="card">
    <a href="/article/partdesigner/">
        <h1>Lego Part Designer</h1>
    </a>
    <div class="timestamp">May  1, 2019</div>
    <div class="content">
        <p><figure>
    <a href="partdesigner.png">
        <img src="partdesigner.png" alt="">
    </a>
</figure></p>
<p>I made a web app that lets you design your own Lego Technic parts and save them as printable STL files.
You can check it out <a href="https://marian42.de/partdesigner/">here</a>.</p>
<p>I got the idea for this project when I was building with Lego parts and wondered how many of the common parts can be described with a simple rule set.
The system I came up with assembles the parts out of five basic blocks:
Pin Hole, Axle Hole, Pin, Axle and Solid.</p>
<p><figure>
    <a href="blocks.png">
        <img src="blocks_1280.png" alt="">
    </a>
</figure></p>
<p>Internally, each block consists of four <em>small blocks</em>.
By default, double sized blocks are created that consist of eight small blocks.
All blocks are placed using coordinates of the small blocks so that they can be placed at &quot;half&quot; positions.</p>
<p>To accomodate 0.2 mm margins at the outside faces of the part, the small blocks are split further into three <em>tiny blocks</em> per dimension.
The two outer tiny blocks have the size of the margin and the center tiny block takes the remaining space.
Note that a tiny block can be in the center on one axis and in the margin on another.
The code has some logic to determine which tiny blocks are part of the model and which aren't.
Finally, before rendering the tiny blocks, they are merged to lower the number of polygons.</p>
<p><figure>
    <a href="tinyblocks.png">
        <img src="tinyblocks_1280.png" alt="">
    </a>
</figure></p>
<p>The app is written in TypeScript and uses WebGL to render the model.
The difficult part is generating the mesh for the model.
This is done directly in the TypeScript code, <em>without</em> using a <a href="https://en.wikipedia.org/wiki/Constructive_solid_geometry">CSG</a> library.
There are no big surprises in the implementation, just lots and lots of corner cases to handle, many of them literal corner cases.
The source code for this project is available on <a href="https://github.com/marian42/partdesigner">Github</a>.</p>
<p>One problem with TypeScript is its lack of support for <a href="https://github.com/Microsoft/TypeScript/issues/6936">operator overloading</a>.
This project uses lots of vector operations and without operator overloading, I can't write <code>v1 = v2 + v3 * f;</code>, instead I have to write <code>v1 = v2.plus(v3.times(f));</code>.
This can make the code unnecessarily cluttered.</p>
<p>The app features a catalog that shows a selection of existing Lego parts that can be made with this system.
Of course the point of this tool is to make parts that don't already exist, but this can give you some inspiration.</p>
<p><figure>
    <a href="catalog.png">
        <img src="catalog.png" alt="">
    </a>
</figure></p>
<p>The preview images for the catalog are not stored on the server.
Instead, they are rendered using the same code that renders the model in the editor.</p>
<h1>Orrery gear box</h1>
<p>To demonstrate the practical use of this app, I made a gear box for a Lego orrery.
The orrery is based on <a href="https://jkbrickworks.com/earth-moon-and-sun-orrery/">a design from JK Brickworks</a>.
I took the sun, earth and moon design from that model and designed everything else myself.</p>
<p>Here is the <a href="https://marian42.de/partdesigner/?part=190x11f5x129by0313y039by0434y0192y0269x1380Z0426x15acZ068ex11edy073y097y0c4y0fby013dy02edx14e0x1787x118by01e6y0766x024fy02c7y0977x034fy03e8y0562x1730x195ax1be8y0493y0d47y03bcX263fx183ax1a95x1d7y2467y210ey2512y21f9y0262y0564y0ee4y0636y0107ay06b5Z07afz078ax19c0Z0b00x1167y1229y0327y0469Y05f7y01b5y1292y03afy0514Y06c9y0141y11fby02f1y1c5bx118fy1264y0379y157by164dy13ecy1566y0734y11254y0497y1638y0831y11425y0dd1x146by17dby0516y18d8y0b2ez0dd2z0f63x199ey1c34Z0da7Z0acay110ccY0147dy1568y1736y0960y01640y01aaey163ay1833y0a8cy01850y01d01y11112x15fby0a1by06cdy0b47y010e4y01297y0bf0y01ab0y0d4fy01d03y046fy25fdy07dfy0a1dy0cbfy2fcdy051ay26cfy08dcy0b49y0e1ey21163y05d8y0e05y01316y06aay0f7fY014e7y0791z18a0z19c7z11115z112e1z116d7x19a2y01499Y0acey01689Y0c13y01ae3y0d72y01d36y0eecy01facy01082y02246y01904x1125cy01646x11ab4x11faex1253cy0142dy02821y0186dx11d20x12263x1">gear box in the part designer</a>:</p>
<p><figure>
    <a href="orrerybase.png">
        <img src="orrerybase.png" alt="">
    </a>
</figure></p>
<p>After printing and adding gears, it looks like this:</p>
<p><figure>
    <a href="gears.jpg">
        <img src="gears_1280.jpg" alt="">
    </a>
</figure></p>
<p><figure>
    <a href="orrery1.jpg">
        <img src="orrery1_1280.jpg" alt="">
    </a>
</figure></p>
<p>And finally, here is the completed orrery:</p>
<p><figure>
    <a href="orrery2.jpg">
        <img src="orrery2_1280.jpg" alt="">
    </a>
</figure></p>
<p>The gears run reasonably smoothly in the printed part.
Choosing the size of the axle holes is a tradeoff between having too much resistance and being too loose.
Of course the real, injection molded parts have tighter tolerances than one can achieve with a consumer 3D printer.
This example shows that 3D printed parts can be combined with original Lego parts.
One advantage of printing parts like this is that it saves you the time to figure out how a structure can be made with existing Lego parts.</p>

    </div>
</article>

        <footer>
            <div class="socials">
                <div class="inner-div">
                    <a href="mailto:mail@marian42.de">
                        Contact
                    </a>
                </div>
                <div>
                    <a href="https://mastodon.gamedev.place/@marian42" rel="me" title="Follow me on Mastodon" class="social-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="-32 0 512 512">                                
                            <path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/>
                        </svg>
                    </a>
                    <a href="https://twitter.com/marian42_" title="Follow me on Twitter" class="social-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 248 204">
                            <path d="M221.95,51.29c0.15,2.17,0.15,4.34,0.15,6.53c0,66.73-50.8,143.69-143.69,143.69v-0.04 C50.97,201.51,24.1,193.65,1,178.83c3.99,0.48,8,0.72,12.02,0.73c22.74,0.02,44.83-7.61,62.72-21.66 c-21.61-0.41-40.56-14.5-47.18-35.07c7.57,1.46,15.37,1.16,22.8-0.87C27.8,117.2,10.85,96.5,10.85,72.46c0-0.22,0-0.43,0-0.64 c7.02,3.91,14.88,6.08,22.92,6.32C11.58,63.31,4.74,33.79,18.14,10.71c25.64,31.55,63.47,50.73,104.08,52.76 c-4.07-17.54,1.49-35.92,14.61-48.25c20.34-19.12,52.33-18.14,71.45,2.19c11.31-2.23,22.15-6.38,32.07-12.26 c-3.77,11.69-11.66,21.62-22.2,27.93c10.01-1.18,19.79-3.86,29-7.95C240.37,35.29,231.83,44.14,221.95,51.29z"/>
                        </svg>
                    </a>
                    <a href="https://github.com/marian42" title="View my code on Github" class="social-icon">
                        <svg viewbox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"/>
                        </svg>
                    </a>
                    <a href="/index.xml" title="RSS feed" class="social-icon">
                        <svg viewBox="0 0 8 8" xmlns="http://www.w3.org/2000/svg">
                            <path d="M 0.38705632,0.38705632 V 1.5913525 A 6.021594,6.021594 0 0 1 6.4086474,7.6129437 H 7.6129437 A 7.2259129,7.2259129 0 0 0 0.38705632,0.38705632 Z m 0,2.40864748 V 4 A 3.6129564,3.6129564 0 0 1 4,7.6129437 H 5.2042963 A 4.8172751,4.8172751 0 0 0 0.38705632,2.7957038 Z M 1.3430849,5.7008865 A 0.95602666,0.95602666 0 0 0 0.38705632,6.6569151 0.95602666,0.95602666 0 0 0 1.3430849,7.6129437 0.95602666,0.95602666 0 0 0 2.2991135,6.6569151 0.95602666,0.95602666 0 0 0 1.3430849,5.7008865 Z" />
                        </svg>
                    </a>
                </div>
            </div>
            <div class="decorator triangle-pattern">
            </div>
        </footer>
    </body>
</html>